# Introduction #
## Example with a USB Relay Board ##

Here the complete Java code for an Actuator (USB Relay Board) produced by [this italian firm](http://www.progettihwsw.com/scheda_rele_usb.htm?gclid=CIyD8NLA1JgCFUM-3godQxvI1g).


```
import it.freedom.exceptions.NoObjectFoundException;
import it.freedom.api.Actuator;
import it.freedom.environment.objects.ElectricDevice;
import it.freedom.environment.objects.Light;
import it.freedom.exceptions.UnableToExecuteException;
import it.freedom.reactions.Command;
import it.nicoletti.serial.SerialConnectionProvider;
import it.nicoletti.serial.SerialDataConsumer;
import java.io.IOException;
import java.util.Properties;

/**
 * An actuator for this USB Relay board
 * http://www.progettihwsw.com/scheda_rele_usb.htm?gclid=CIyD8NLA1JgCFUM-3godQxvI1g
 *
 */
public class UsbRelayBoard extends Actuator implements SerialDataConsumer {

    SerialConnectionProvider usb;
    Properties protocol = new Properties(); //defines the protocol using a hashmap

    public UsbRelayBoard() {
        super("USB Relay Board");
        fillProtocolData();
        connect(); //connects to usb device
        start(); //starts the plugin
    }

    private void fillProtocolData() {
        protocol.setProperty("6", "I"); //relay 1 on
        protocol.setProperty("7", "L"); //replay 1 off
        protocol.setProperty("8", "M"); //relay 2 on
        protocol.setProperty("9", "N"); //replay 2 off
        protocol.setProperty("a", "O"); //relay 3 on
        protocol.setProperty("b", "P"); //relay 3 off
        protocol.setProperty("c", "Q"); //relay 4 on
        protocol.setProperty("d", "R"); //relay 4 off
        protocol.setProperty("0", "A"); //led 1 on
        protocol.setProperty("2", "C"); //led 1 off
    }

    private void connect() {
        usb = new SerialConnectionProvider();
        usb.setAutodiscover("0", "A"); //query all ports for a device which replies "A" to the message "0"
        usb.addListener(this); //listener for data generated by the usb device (forwarded to onDataAvailable method)
    }

    @Override
    public void onCommand(Command c) throws IOException, UnableToExecuteException {
        String message = c.getProperty("message"); //get the "message" property from the received Command
        String deviceReply = null;
        try {
            deviceReply = usb.send(message.trim()); //sends message to usb device reading its reply
        } catch (IOException ex) {
            System.err.println("Unable to write data on serial port " + usb.getPortName() +
                    ". Maybe the device is not connected to this port.");
        }
        String expectedReply = protocol.getProperty(message); //expected reply to message based on protocol

        if (deviceReply.equals(expectedReply)) {
            System.out.println("Device on port " + usb.getPortName() + " replies '" +
                    deviceReply + "' to message '" + message + "'");
        }else{
            System.err.println("Uncorrect reply by device on port " + usb.getPortName() + ". It replies '" + deviceReply +
                    "' to message '" + message + "'" + " when '" + expectedReply + "' is expected.");
        }
    }

/*
 * used only to update the state of the object in Freedom
 */
    protected void setTargetObjectBehavior(Command c) {
        //getting a safe reference to the targer object if exist
        ElectricDevice dev = null;
        try {
            dev = c.getTargetObject(ElectricDevice.class);
        } catch (NoObjectFoundException ex) {
            System.err.println("Undefined target object '" + c.getProperty("object") + "' in command '" + c.getName() + "'");
        } catch (ClassCastException classEx) {
            System.err.println("Attempt to handle an '" + c.getProperty("object") + "' as an 'ElectricDevice' -> " + classEx.getLocalizedMessage());
        }

        //getting the behavior to apply
        String state = c.getBehavior();

        try {
            if (state.equalsIgnoreCase("on")) {
                dev.switchOn(c.getProperties());
            }
            if (state.equalsIgnoreCase("off")) {
                dev.switchOff(c.getProperties());
            }
            if (state.equalsIgnoreCase("dim")) {
                Light light = (Light) dev;
                light.dim(c.getProperties());
            }
        } catch (Exception e) {
            System.err.println("Unable to change behavior");
        }
    }

    public void onDataAvailable(String data) {
        //do nothing
    }

    public boolean canExecute(Command c) {
        throw new UnsupportedOperationException("Not supported yet.");
    }
}
```